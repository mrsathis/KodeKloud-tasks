
Application Security
====================

Question:

We have a backup management application UI hosted on Nautilus's backup server in Stratos DC. That backup management application code is deployed under Apache on the backup server itself, and Nginx is running as a reverse proxy on the same server. Apache and Nginx ports are 8082 and 8098, respectively. We have iptables firewall installed on this server. Make the appropriate changes to fulfill the requirements mentioned below:


We want to open all incoming connections to Nginx's port and block all incoming connections to Apache's port. Also make sure rules are permanent.

Answers:

[clint@stbkp01 ~]$ sudo iptables -A INPUT -p tcp --dport 8098 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT

[clint@stbkp01 ~]$ sudo iptables -L
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:8098 ctstate NEW,ESTABLISHED

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

[clint@stbkp01 ~]$ sudo iptables -A INPUT -p tcp --dport 8082 -m conntrack --ctstate NEW -j REJECT

[clint@stbkp01 ~]$ sudo iptables -L
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:8098 ctstate NEW,ESTABLISHED
REJECT     tcp  --  anywhere             anywhere             tcp dpt:us-cli ctstate NEW reject-with icmp-port-unreachable

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

[clint@stbkp01 ~]$ sudo iptables-save > /etc/sysconfig/iptables
-bash: /etc/sysconfig/iptables: Permission denied

[clint@stbkp01 ~]$ sudo su

[root@stbkp01 clint]# iptables-save > /etc/sysconfig/iptables

[root@stbkp01 clint]# 
[root@stbkp01 clint]# 

[root@stbkp01 clint]# cat /etc/sysconfig/iptables
# Generated by iptables-save v1.4.21 on Sat Apr  3 14:39:02 2021
*filter
:INPUT ACCEPT [283:19600]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [148:14120]
-A INPUT -p tcp -m tcp --dport 8098 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m tcp --dport 8082 -m conntrack --ctstate NEW -j REJECT --reject-with icmp-port-unreachable
COMMIT
# Completed on Sat Apr  3 14:39:02 2021
# Generated by iptables-save v1.4.21 on Sat Apr  3 14:39:02 2021
*nat
:PREROUTING ACCEPT [15:1666]
:INPUT ACCEPT [1:60]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [4:320]
:DOCKER_OUTPUT - [0:0]
:DOCKER_POSTROUTING - [0:0]
-A OUTPUT -d 127.0.0.11/32 -j DOCKER_OUTPUT
-A POSTROUTING -d 127.0.0.11/32 -j DOCKER_POSTROUTING
-A DOCKER_OUTPUT -d 127.0.0.11/32 -p tcp -m tcp --dport 53 -j DNAT --to-destination 127.0.0.11:38859
-A DOCKER_OUTPUT -d 127.0.0.11/32 -p udp -m udp --dport 53 -j DNAT --to-destination 127.0.0.11:49422
-A DOCKER_POSTROUTING -s 127.0.0.11/32 -p tcp -m tcp --sport 38859 -j SNAT --to-source :53
-A DOCKER_POSTROUTING -s 127.0.0.11/32 -p udp -m udp --sport 49422 -j SNAT --to-source :53
COMMIT
# Completed on Sat Apr  3 14:39:02 2021
[root@stbkp01 clint]# 